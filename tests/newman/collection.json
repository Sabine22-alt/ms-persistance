{
  "info": {
    "name": "ms-persistence API Tests",
    "_postman_id": "Integration Tests for ms-persistence",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Health Check",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response contains health message\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"healthy\");",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/health",
          "host": ["{{baseUrl}}"],
          "path": ["health"]
        }
      }
    },
    {
      "name": "Actuator Health",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Health status is UP\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.status).to.equal('UP');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/actuator/health",
          "host": ["{{baseUrl}}"],
          "path": ["actuator", "health"]
        }
      }
    },
    {
      "name": "Home Page",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200 && pm.response.text().includes('API is running')) {",
              "    pm.test('Home page OK', function () {",
              "        pm.expect(pm.response.code).to.equal(200);",
              "    });",
              "} else {",
              "    pm.sendRequest(pm.environment.get('baseUrl') + '/actuator/health', function (err, res) {",
              "        pm.test('Actuator health fallback is UP', function () {",
              "            pm.expect(err).to.equal(null);",
              "            pm.expect(res).to.have.property('code', 200);",
              "        });",
              "    });",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/",
          "host": ["{{baseUrl}}"],
          "path": [""]
        }
      }
    },
    {
      "name": "API Status",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/status",
          "host": ["{{baseUrl}}"],
          "path": ["api", "status"]
        }
      }
    },
    {
      "name": "Database Connection Test",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/actuator/health",
          "host": ["{{baseUrl}}"],
          "path": ["actuator", "health"]
        }
      }
    },
    {
      "name": "1. Create Aliment",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 201\", function () { pm.response.to.have.status(201); });",
              "pm.test(\"Response has id\", function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('id'); pm.environment.set('alimentId', jsonData.id); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "body": {"mode": "raw", "raw": "{\"nom\": \"{{alimentNom}}\", \"categorieAliment\": \"{{alimentCategorie}}\", \"calories\": 18, \"proteines\": 0.9, \"glucides\": 3.9, \"lipides\": 0.2, \"fibres\": 1.2}"},
        "url": {"raw": "{{baseUrl}}/api/persistance/aliments", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "aliments"]}
      }
    },
    {
      "name": "2. Create Utilisateur",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 201\", function () { pm.response.to.have.status(201); });",
              "pm.test(\"Response has id\", function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('id'); pm.environment.set('utilisateurId', jsonData.id); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "body": {"mode": "raw", "raw": "{\"email\": \"{{utilisateurEmail}}\", \"motDePasse\": \"{{utilisateurMotDePasse}}\", \"nom\": \"{{utilisateurNom}}\", \"prenom\": \"{{utilisateurPrenom}}\", \"role\": \"{{utilisateurRole}}\"}"},
        "url": {"raw": "{{baseUrl}}/api/persistance/utilisateurs", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "utilisateurs"]}
      }
    },
    {
      "name": "3. Create Recette",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 201\", function () { pm.response.to.have.status(201); });",
              "pm.test(\"Response has id\", function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('id'); pm.environment.set('recetteId', jsonData.id); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "body": {"mode": "raw", "raw": "{\"titre\": \"Salade\", \"utilisateurId\": {{utilisateurId}}, \"ingredients\": [{\"alimentId\": {{alimentId}}, \"quantite\": 100, \"unite\": \"GRAMME\"}], \"etapes\": [{\"ordre\": 1, \"texte\": \"Mélanger les ingrédients\", \"temps\": 5}]}"},
        "url": {"raw": "{{baseUrl}}/api/persistance/recettes", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "recettes"]}
      }
    },
    {
      "name": "3.5. Clean Existing Feedbacks",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// Accepter 200 (feedbacks supprimés) ou 404 (aucun feedback) ou 500 (erreur)",
              "pm.test(\"Nettoyage des feedbacks existants\", function () {",
              "    pm.expect([200, 404, 500]).to.include(pm.response.code);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/feedbacks/utilisateur/{{utilisateurId}}/recette/{{recetteId}}", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "feedbacks", "utilisateur", "{{utilisateurId}}", "recette", "{{recetteId}}"]}
      }
    },
    {
      "name": "4. Create Feedback",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code !== 201) {",
              "    console.log('ERREUR - Status:', pm.response.code);",
              "    console.log('ERREUR - Body:', pm.response.text());",
              "}",
              "pm.test(\"Status code is 201\", function () { pm.response.to.have.status(201); });",
              "pm.test(\"Response has id\", function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('id'); pm.environment.set('feedbackId', jsonData.id); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "body": {"mode": "raw", "raw": "{\"utilisateurId\": {{utilisateurId}}, \"recetteId\": {{recetteId}}, \"evaluation\": {{feedbackEvaluation}}, \"commentaire\": \"{{feedbackCommentaire}}\"}"},
        "url": {"raw": "{{baseUrl}}/api/persistance/feedbacks", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "feedbacks"]}
      }
    },
    {
      "name": "5. Get All Aliments",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response is array\", function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.be.an('array'); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/aliments", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "aliments"]}
      }
    },
    {
      "name": "6. Get Aliment by ID",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response has correct id\", function () { var jsonData = pm.response.json(); pm.expect(jsonData.id).to.equal(pm.environment.get('alimentId')); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/aliments/{{alimentId}}", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "aliments", "{{alimentId}}"]}
      }
    },
    {
      "name": "7. Update Aliment",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response has updated name\", function () { var jsonData = pm.response.json(); pm.expect(jsonData.nom).to.equal('Carotte'); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "body": {"mode": "raw", "raw": "{\"nom\": \"Carotte\", \"categorieAliment\": \"LEGUME\", \"calories\": 41, \"proteines\": 0.9, \"glucides\": 10, \"lipides\": 0.2, \"fibres\": 2.8}"},
        "url": {"raw": "{{baseUrl}}/api/persistance/aliments/{{alimentId}}", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "aliments", "{{alimentId}}"]}
      }
    },
    {
      "name": "8. Get All Recettes",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response is array\", function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.be.an('array'); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/recettes", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "recettes"]}
      }
    },
    {
      "name": "9. Get Recette by ID",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response has correct id\", function () { var jsonData = pm.response.json(); pm.expect(jsonData.id).to.equal(pm.environment.get('recetteId')); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/recettes/{{recetteId}}", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "recettes", "{{recetteId}}"]}
      }
    },
    {
      "name": "10. Update Recette",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response has updated title\", function () { var jsonData = pm.response.json(); pm.expect(jsonData.titre).to.equal('Salade César'); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "body": {"mode": "raw", "raw": "{\"titre\": \"Salade César\", \"utilisateurId\": {{utilisateurId}}, \"ingredients\": [{\"alimentId\": {{alimentId}}, \"quantite\": 150, \"unite\": \"GRAMME\"}], \"etapes\": [{\"ordre\": 1, \"texte\": \"Préparer la sauce\", \"temps\": 10}]}"},
        "url": {"raw": "{{baseUrl}}/api/persistance/recettes/{{recetteId}}", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "recettes", "{{recetteId}}"]}
      }
    },
    {
      "name": "11. Get All Feedbacks",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response is array\", function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.be.an('array'); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/feedbacks", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "feedbacks"]}
      }
    },
    {
      "name": "12. Get Feedback by ID",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response has correct id\", function () { var jsonData = pm.response.json(); pm.expect(jsonData.id).to.equal(pm.environment.get('feedbackId')); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/feedbacks/{{feedbackId}}", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "feedbacks", "{{feedbackId}}"]}
      }
    },
    {
      "name": "13. Update Feedback",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response has updated evaluation\", function () { var jsonData = pm.response.json(); pm.expect(jsonData.evaluation).to.equal(4); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "body": {"mode": "raw", "raw": "{\"evaluation\": 4, \"commentaire\": \"Très bon\"}"},
        "url": {"raw": "{{baseUrl}}/api/persistance/feedbacks/{{feedbackId}}", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "feedbacks", "{{feedbackId}}"]}
      }
    },
    {
      "name": "14. Delete Feedback",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 204\", function () { pm.response.to.have.status(204); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/feedbacks/{{feedbackId}}", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "feedbacks", "{{feedbackId}}"]}
      }
    },
    {
      "name": "15. Get All Utilisateurs",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response is array\", function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.be.an('array'); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/utilisateurs", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "utilisateurs"]}
      }
    },
    {
      "name": "16. Get Utilisateur by ID",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response has correct id\", function () { var jsonData = pm.response.json(); pm.expect(jsonData.id).to.equal(pm.environment.get('utilisateurId')); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/utilisateurs/{{utilisateurId}}", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "utilisateurs", "{{utilisateurId}}"]}
      }
    },
    {
      "name": "17. Update Utilisateur",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response has updated name\", function () { var jsonData = pm.response.json(); pm.expect(jsonData.nom).to.equal('Martin'); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "body": {"mode": "raw", "raw": "{\"email\": \"test@example.com\", \"motDePasse\": \"password123\", \"nom\": \"Martin\", \"prenom\": \"Jean\", \"role\": \"USER\"}"},
        "url": {"raw": "{{baseUrl}}/api/persistance/utilisateurs/{{utilisateurId}}", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "utilisateurs", "{{utilisateurId}}"]}
      }
    },
    {
      "name": "18. Delete Utilisateur",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 204\", function () { pm.response.to.have.status(204); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/utilisateurs/{{utilisateurId}}", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "utilisateurs", "{{utilisateurId}}"]}
      }
    },
    {
      "name": "Recettes En Attente",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response is array\", function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.be.an('array'); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/recettes/en-attente", "host": ["{{baseUrl}}"], "path": ["api","persistance","recettes","en-attente"]}
      }
    },
    {
      "name": "19. Create Recette for Validation",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 201\", function () { pm.response.to.have.status(201); });",
              "pm.test(\"Response has id and status EN_ATTENTE\", function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('id'); pm.environment.set('recetteValidationId', jsonData.id); pm.expect(jsonData.statut).to.equal('EN_ATTENTE'); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "body": {"mode": "raw", "raw": "{\"titre\": \"Soupe à l'oignon\", \"description\": \"Une délicieuse soupe\", \"utilisateurId\": {{utilisateurId}}, \"ingredients\": [{\"alimentId\": {{alimentId}}, \"quantite\": 200, \"unite\": \"GRAMME\"}], \"etapes\": [{\"ordre\": 1, \"texte\": \"Couper les oignons\", \"temps\": 10}]}"},
        "url": {"raw": "{{baseUrl}}/api/persistance/recettes", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "recettes"]}
      }
    },
    {
      "name": "Valider Recette",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Recette validée\", function () { var jsonData = pm.response.json(); pm.expect(jsonData.statut).to.equal('VALIDEE'); pm.expect(jsonData.actif).to.equal(true); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/recettes/{{recetteValidationId}}/valider", "host": ["{{baseUrl}}"], "path": ["api","persistance","recettes","{{recetteValidationId}}","valider"]}
      }
    },
    {
      "name": "20. Create Recette for Rejection",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 201\", function () { pm.response.to.have.status(201); });",
              "pm.test(\"Response has id\", function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('id'); pm.environment.set('recetteRejectionId', jsonData.id); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "body": {"mode": "raw", "raw": "{\"titre\": \"Recette à rejeter\", \"description\": \"Recette de test pour rejeter\", \"utilisateurId\": {{utilisateurId}}, \"ingredients\": [{\"alimentNom\": \"Farine\", \"quantite\": 100, \"unite\": \"GRAMME\"}], \"etapes\": [{\"ordre\": 1, \"texte\": \"Mélanger tous les ingrédients\", \"temps\": 5}]}"},
        "url": {"raw": "{{baseUrl}}/api/persistance/recettes", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "recettes"]}
      }
    },
    {
      "name": "Rejeter Recette",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Recette rejetée\", function () { var jsonData = pm.response.json(); pm.expect(jsonData.statut).to.equal('REJETEE'); pm.expect(jsonData.motifRejet).to.be.a('string').and.not.empty; });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "body": {"mode": "raw", "raw": "{\"motif\": \"Recette incomplète, ingrédients et étapes manquants\"}"},
        "url": {"raw": "{{baseUrl}}/api/persistance/recettes/{{recetteRejectionId}}/rejeter", "host": ["{{baseUrl}}"], "path": ["api","persistance","recettes","{{recetteRejectionId}}","rejeter"]}
      }
    },
    {
      "name": "21. Create Recette with Named Ingredients",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 201\", function () { pm.response.to.have.status(201); });",
              "pm.test(\"Response has id and ingredients with aliments created\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('id');",
              "    pm.environment.set('recetteWithNamedIngredientsId', jsonData.id);",
              "    pm.expect(jsonData.ingredients).to.be.an('array').and.not.empty;",
              "    pm.expect(jsonData.ingredients[0]).to.have.property('alimentNom');",
              "    pm.expect(['Pâtes', 'Œufs', 'Bacon']).to.include(jsonData.ingredients[0].alimentNom);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "body": {
          "mode": "raw",
          "raw": "{\"titre\": \"Pâtes Carbonara\", \"description\": \"Recette traditionnelle\", \"tempsTotal\": 30, \"utilisateurId\": {{utilisateurId}}, \"ingredients\": [{\"alimentNom\": \"Pâtes\", \"quantite\": 250, \"unite\": \"GRAMME\"}, {\"alimentNom\": \"Œufs\", \"quantite\": 3, \"unite\": \"UNITE\"}, {\"alimentNom\": \"Bacon\", \"quantite\": 100, \"unite\": \"GRAMME\"}], \"etapes\": [{\"ordre\": 1, \"texte\": \"Cuire les pâtes\", \"temps\": 10}, {\"ordre\": 2, \"texte\": \"Mélanger avec les œufs et le bacon\", \"temps\": 5}]}"
        },
        "url": {"raw": "{{baseUrl}}/api/persistance/recettes", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "recettes"]}
      }
    },
    {
      "name": "22. Verify Auto-Created Aliments",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Aliments Pâtes, Œufs, Bacon have been created\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.be.an('array');",
              "    var alimentNames = jsonData.map(a => a.nom);",
              "    pm.expect(alimentNames).to.include('Pâtes');",
              "    pm.expect(alimentNames).to.include('Œufs');",
              "    pm.expect(alimentNames).to.include('Bacon');",
              "    // Verify auto-created aliments have AUTRE category",
              "    var pates = jsonData.find(a => a.nom === 'Pâtes');",
              "    if (pates) pm.expect(pates.categorieAliment).to.equal('AUTRE');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/aliments", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "aliments"]}
      }
    },
    {
      "name": "23. Get Notifications for User 1",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response is array of notifications\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.be.an('array');",
              "    if (jsonData.length > 0) {",
              "        pm.expect(jsonData[0]).to.have.property('id');",
              "        pm.expect(jsonData[0]).to.have.property('utilisateurId');",
              "        pm.expect(jsonData[0]).to.have.property('recetteId');",
              "        pm.expect(jsonData[0]).to.have.property('type');",
              "        pm.expect(jsonData[0]).to.have.property('message');",
              "        pm.expect(jsonData[0]).to.have.property('lue');",
              "        pm.environment.set('notificationId', jsonData[0].id);",
              "    }",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/notifications/utilisateur/1", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "notifications", "utilisateur", "1"]}
      }
    },
    {
      "name": "24. Get Unread Notifications for User 1",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"All notifications are unread\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.be.an('array');",
              "    if (jsonData.length > 0) {",
              "        jsonData.forEach(function(notification) {",
              "            pm.expect(notification.lue).to.equal(false);",
              "        });",
              "    }",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/notifications/utilisateur/1/non-lues", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "notifications", "utilisateur", "1", "non-lues"]}
      }
    },
    {
      "name": "25. Count Unread Notifications",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response has count property\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('count');",
              "    pm.expect(jsonData.count).to.be.a('number');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/notifications/utilisateur/1/count", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "notifications", "utilisateur", "1", "count"]}
      }
    },
    {
      "name": "26. Mark Notification as Read",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.environment.get('notificationId')) {",
              "    pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "    pm.test(\"Notification marked as read\", function () {",
              "        var jsonData = pm.response.json();",
              "        pm.expect(jsonData.lue).to.equal(true);",
              "    });",
              "} else {",
              "    pm.test(\"Skipped - no notification ID available\", function () {",
              "        pm.expect(true).to.equal(true);",
              "    });",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/notifications/{{notificationId}}/lire", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "notifications", "{{notificationId}}", "lire"]}
      }
    },
    {
      "name": "27. Mark All Notifications as Read",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Success message returned\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('message');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/notifications/utilisateur/1/tout-lire", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "notifications", "utilisateur", "1", "tout-lire"]}
      }
    },
    {
      "name": "19. Delete Recette for CRUD",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 204\", function () { pm.response.to.have.status(204); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/recettes/{{recetteId}}", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "recettes", "{{recetteId}}"]}
      }
    },
    {
      "name": "20. Delete Validation Recette",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 204\", function () { pm.response.to.have.status(204); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/recettes/{{recetteValidationId}}", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "recettes", "{{recetteValidationId}}"]}
      }
    },
    {
      "name": "21. Delete Rejection Recette",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 204\", function () { pm.response.to.have.status(204); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/recettes/{{recetteRejectionId}}", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "recettes", "{{recetteRejectionId}}"]}
      }
    },
    {
      "name": "22. Delete Named Ingredients Recette",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 204\", function () { pm.response.to.have.status(204); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/recettes/{{recetteWithNamedIngredientsId}}", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "recettes", "{{recetteWithNamedIngredientsId}}"]}
      }
    },
    {
      "name": "23. Delete Aliment",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 204\", function () { pm.response.to.have.status(204); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [],
        "url": {"raw": "{{baseUrl}}/api/persistance/aliments/{{alimentId}}", "host": ["{{baseUrl}}"], "path": ["api", "persistance", "aliments", "{{alimentId}}"]}
      }
    }
  ]
}

