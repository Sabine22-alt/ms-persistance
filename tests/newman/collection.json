{
  "info": {
    "name": "ms-persistence API Tests",
    "_postman_id": "Integration Tests for ms-persistence",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Health Check",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response contains health message\", function () {",
              "    pm.expect(pm.response.text()).to.include(\"healthy\");",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/health",
          "host": ["{{baseUrl}}"],
          "path": ["health"]
        }
      }
    },
    {
      "name": "Actuator Health",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Health status is UP\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.status).to.equal('UP');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/actuator/health",
          "host": ["{{baseUrl}}"],
          "path": ["actuator", "health"]
        }
      }
    },
    {
      "name": "Home Page",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response contains API running message\", function () {",
              "    pm.expect(pm.response.text()).to.include('API is running');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/",
          "host": ["{{baseUrl}}"],
          "path": [""]
        }
      }
    },
    {
      "name": "API Status",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response has JSON body\", function () {",
              "    pm.response.to.be.json;",
              "});",
              "",
              "pm.test(\"Response contains application name\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('applicationName');",
              "    pm.expect(jsonData).to.have.property('version');",
              "    pm.expect(jsonData).to.have.property('status');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/status",
          "host": ["{{baseUrl}}"],
          "path": ["api", "status"]
        }
      }
    },
    {
      "name": "Database Connection Test",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Database connection is successful\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('mysql');",
              "    pm.expect(jsonData.mysql).to.include('successful');",
              "    pm.expect(jsonData.status).to.equal('ready');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/database/test",
          "host": ["{{baseUrl}}"],
          "path": ["api", "database", "test"]
        }
      }
    },
    {
      "name": "1. Create Aliment",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 201\", function () { pm.response.to.have.status(201); });",
              "pm.test(\"Response has id\", function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('id'); pm.environment.set('alimentId', jsonData.id); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"nom\": \"{{alimentNom}}\", \"categorie\": \"{{alimentCategorie}}\"}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/persistance/aliments",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "aliments"]
        }
      }
    },
    {
      "name": "2. Create Utilisateur",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 201\", function () { pm.response.to.have.status(201); });",
              "pm.test(\"Response has id\", function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('id'); pm.environment.set('utilisateurId', jsonData.id); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"email\": \"{{utilisateurEmail}}\", \"motDePasse\": \"{{utilisateurMotDePasse}}\", \"nom\": \"{{utilisateurNom}}\", \"prenom\": \"{{utilisateurPrenom}}\", \"role\": \"{{utilisateurRole}}\"}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/persistance/utilisateurs",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "utilisateurs"]
        }
      }
    },
    {
      "name": "3. Create Recette",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 201\", function () { pm.response.to.have.status(201); });",
              "pm.test(\"Response has id\", function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('id'); pm.environment.set('recetteId', jsonData.id); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"titre\": \"Salade\", \"ingredients\": [{\"alimentId\": {{alimentId}}, \"quantite\": 100, \"unite\": \"GRAMME\"}], \"etapes\": [{\"ordre\": 1, \"texte\": \"Mélanger les ingrédients\", \"temps\": 5}]}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/persistance/recettes",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "recettes"]
        }
      }
    },
    {
      "name": "4. Create Feedback",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 201\", function () { pm.response.to.have.status(201); });",
              "pm.test(\"Response has id\", function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.have.property('id'); pm.environment.set('feedbackId', jsonData.id); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"utilisateurId\": {{utilisateurId}}, \"recetteId\": {{recetteId}}, \"evaluation\": {{feedbackEvaluation}}, \"commentaire\": \"{{feedbackCommentaire}}\"}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/persistance/feedbacks",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "feedbacks"]
        }
      }
    },
    {
      "name": "5. Get All Aliments",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response is array\", function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.be.an('array'); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/persistance/aliments",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "aliments"]
        }
      }
    },
    {
      "name": "6. Get Aliment by ID",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response has correct id\", function () { var jsonData = pm.response.json(); pm.expect(jsonData.id).to.equal(pm.environment.get('alimentId')); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/persistance/aliments/{{alimentId}}",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "aliments", "{{alimentId}}"]
        }
      }
    },
    {
      "name": "7. Update Aliment",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response has updated name\", function () { var jsonData = pm.response.json(); pm.expect(jsonData.nom).to.equal('Carotte'); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"nom\": \"Carotte\", \"categorie\": \"LEGUME\"}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/persistance/aliments/{{alimentId}}",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "aliments", "{{alimentId}}"]
        }
      }
    },
    {
      "name": "8. Get All Recettes",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response is array\", function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.be.an('array'); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/persistance/recettes",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "recettes"]
        }
      }
    },
    {
      "name": "9. Get Recette by ID",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response has correct id\", function () { var jsonData = pm.response.json(); pm.expect(jsonData.id).to.equal(pm.environment.get('recetteId')); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/persistance/recettes/{{recetteId}}",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "recettes", "{{recetteId}}"]
        }
      }
    },
    {
      "name": "10. Update Recette",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response has updated title\", function () { var jsonData = pm.response.json(); pm.expect(jsonData.titre).to.equal('Salade César'); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"titre\": \"Salade César\", \"ingredients\": [{\"alimentId\": {{alimentId}}, \"quantite\": 150, \"unite\": \"GRAMME\"}], \"etapes\": [{\"ordre\": 1, \"texte\": \"Préparer la sauce\", \"temps\": 10}]}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/persistance/recettes/{{recetteId}}",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "recettes", "{{recetteId}}"]
        }
      }
    },
    {
      "name": "11. Get All Feedbacks",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response is array\", function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.be.an('array'); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/persistance/feedbacks",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "feedbacks"]
        }
      }
    },
    {
      "name": "12. Get Feedback by ID",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response has correct id\", function () { var jsonData = pm.response.json(); pm.expect(jsonData.id).to.equal(pm.environment.get('feedbackId')); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/persistance/feedbacks/{{feedbackId}}",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "feedbacks", "{{feedbackId}}"]
        }
      }
    },
    {
      "name": "13. Update Feedback",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response has updated evaluation\", function () { var jsonData = pm.response.json(); pm.expect(jsonData.evaluation).to.equal(4); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"evaluation\": 4, \"commentaire\": \"Très bon\"}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/persistance/feedbacks/{{feedbackId}}",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "feedbacks", "{{feedbackId}}"]
        }
      }
    },
    {
      "name": "14. Delete Feedback",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 204\", function () { pm.response.to.have.status(204); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/persistance/feedbacks/{{feedbackId}}",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "feedbacks", "{{feedbackId}}"]
        }
      }
    },
    {
      "name": "15. Get All Utilisateurs",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response is array\", function () { var jsonData = pm.response.json(); pm.expect(jsonData).to.be.an('array'); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/persistance/utilisateurs",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "utilisateurs"]
        }
      }
    },
    {
      "name": "16. Get Utilisateur by ID",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response has correct id\", function () { var jsonData = pm.response.json(); pm.expect(jsonData.id).to.equal(pm.environment.get('utilisateurId')); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/persistance/utilisateurs/{{utilisateurId}}",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "utilisateurs", "{{utilisateurId}}"]
        }
      }
    },
    {
      "name": "17. Update Utilisateur",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () { pm.response.to.have.status(200); });",
              "pm.test(\"Response has updated name\", function () { var jsonData = pm.response.json(); pm.expect(jsonData.nom).to.equal('Martin'); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"email\": \"test@example.com\", \"nom\": \"Martin\", \"prenom\": \"Jean\", \"role\": \"USER\"}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/persistance/utilisateurs/{{utilisateurId}}",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "utilisateurs", "{{utilisateurId}}"]
        }
      }
    },
    {
      "name": "18. Delete Utilisateur",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 204\", function () { pm.response.to.have.status(204); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/persistance/utilisateurs/{{utilisateurId}}",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "utilisateurs", "{{utilisateurId}}"]
        }
      }
    },
    {
      "name": "19. Delete Recette",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 204\", function () { pm.response.to.have.status(204); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/persistance/recettes/{{recetteId}}",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "recettes", "{{recetteId}}"]
        }
      }
    },
    {
      "name": "20. Delete Aliment",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 204\", function () { pm.response.to.have.status(204); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/persistance/aliments/{{alimentId}}",
          "host": ["{{baseUrl}}"],
          "path": ["api", "persistance", "aliments", "{{alimentId}}"]
        }
      }
    }
  ]
}
